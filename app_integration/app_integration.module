<?php

/*
 * First we're creating two versions of the app as "widgets". The first one 
 * is an html structure, and the second one is an iframe version of the same. 
*/

$widget1 = "

    <script src='https://d3js.org/d3.v3.min.js'></script>
    <link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css?family=Open+Sans:400,600'>
    <link rel='stylesheet' type='text/css' href='" . drupal_get_path('module', 'app_integration') . "/css/sequences.css'/>

   <div id='main-vis'>
     <h2>Main Div</h2>
      <div id='sequence'></div>
      <div id='chart'>
        <div id='explanation' style='visibility: hidden;'>
          <span id='percentage'></span><br/>
          of visits begin with this sequence of pages
        </div>
      </div>
    </div>
    <div id='sidebar'>
      <h2>Sidebar</h2>
      <input type='checkbox' id='togglelegend'> Legend<br/>
      <div id='legend' style='visibility: hidden;'></div>
    </div>
    <script>var modulePath = '" . drupal_get_path('module', 'app_integration') . "/'; console.log('the path is ' + modulePath);</script>
    <script type='text/javascript' src='" .  drupal_get_path('module', 'app_integration') . "/js/sequences.js'></script>

";

$widget2 = "<iframe frameborder=0 width='100%' height='600' src='" .  drupal_get_path('module', 'app_integration') . "/standalone.html'>
	    <!-- sets the path for the js -->
    <script>var modulePath = '" . drupal_get_path('module', 'app_integration') . "/'; console.log('the path in widget 2 is ' + modulePath);</script>
	</iframe>";

variable_set('widget1', $widget1);
variable_set('widget2', $widget2);

/**
* Create the Drupal blocks. We're creating two Drupal "blocks" that will appear in the site's admin UI in the Blocks list.
*/

/**
 * Implements hook_block_info().
*/
function app_integration_block_info() {
   $blocks = array();
   $blocks['app_integration_widget_1'] = array(
     'info' => t("A sample block with a data visualization generated by the App Integration module"),
   );
   $blocks['app_integration_widget_2'] = array(
     'info' => t("A sample block with an iframed data visualization generated by the App Integration module"),
   );
   return $blocks;
}

/**
* Implements hook_block_view().
*/

function app_integration_block_view($delta = '') {
  $content1 = variable_get('widget1','content not available (widget 1)');
  $content2 = variable_get('widget2','content not available (widget 2)');
  $block = array();
  switch ($delta) {
    case 'app_integration_widget_1':
      $block['title'] = t('App Integration Widget 1');
      $block['content'] = $content1;
      break;
    case 'app_integration_widget_2':
      $block['title'] = t('App Integration Widget 2');
      $block['content'] = $content2;
      break;
    }
  return $block;
}


/**
* This is where we create a page within the CMS (a Drupal Node) 
*/

/**
* Implements hook_menu().
 */

function app_integration_menu() {
  $items['app-integration/example-page'] = array(
    'title' => 'App Integration Module: Example Page',
    'page callback' => 'app_integration_custom',
    'access arguments' => array('access content'),
    'menu_name' => 'main-menu'
  );
 
  return $items;
}

/**
* Custom callback function.
 */

function app_integration_custom() {
  $content['raw_markup'] = array(
    '#type' => 'markup',
    '#markup' => '<p>Our js output (well, just text at the moment, but you get the idea)</p>',
  );
 
  return $content;
}

